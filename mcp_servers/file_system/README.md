# ğŸ—‚ï¸ æ–‡ä»¶ç³»ç»Ÿ (File System)

> ç²¾ç®€é«˜æ•ˆçš„ MCP æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ï¼Œä¼˜åŒ–tokenä½¿ç”¨

## ğŸš€ è®¾è®¡ç†å¿µ

åŸºäº**æ•ˆç‡ä¼˜å…ˆ**çš„åŸåˆ™ï¼Œæœ¬æ–‡ä»¶ç³»ç»Ÿåªæä¾›**çœŸæ­£éœ€è¦**çš„æ ¸å¿ƒå·¥å…·ï¼Œå…¶ä»–ç®€å•æ“ä½œæ¨èä½¿ç”¨å‘½ä»¤è¡Œå¤„ç†ï¼Œå®ç°ï¼š

- ğŸ’° **Tokenä¼˜åŒ–**: å·¥å…·æ•°é‡ä»15ä¸ªç²¾ç®€åˆ°4ä¸ªï¼Œå‡å°‘60-70% tokenä½¿ç”¨
- âš¡ **æå‡æ•ˆç‡**: å‡å°‘é€‰æ‹©å¤æ‚åº¦ï¼ŒAIèƒ½æ›´å¿«é€‰æ‹©åˆé€‚çš„å·¥å…·
- ğŸ¯ **ä¸“æ³¨æ ¸å¿ƒ**: åªåšå‘½ä»¤è¡Œéš¾ä»¥å®ç°çš„å¤æ‚åŠŸèƒ½
- ğŸ”§ **æ˜“äºç»´æŠ¤**: ä»£ç é‡å‡å°‘ï¼Œç»´æŠ¤æˆæœ¬å¤§å¹…é™ä½

## ğŸ“‹ æ ¸å¿ƒå·¥å…· (4ä¸ª)

### 1. ğŸ“„ file_read - é«˜çº§æ–‡ä»¶è¯»å–
```python
await file_read(
    file_path="/path/to/file.txt",
    start_line=10,              # å¼€å§‹è¡Œå·
    end_line=20,                # ç»“æŸè¡Œå·
    encoding="auto",            # è‡ªåŠ¨ç¼–ç æ£€æµ‹
    max_size_mb=10.0           # æ–‡ä»¶å¤§å°é™åˆ¶
)
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… æŒ‰è¡ŒèŒƒå›´è¯»å–
- âœ… è‡ªåŠ¨ç¼–ç æ£€æµ‹
- âœ… æ–‡ä»¶å¤§å°ä¿æŠ¤
- âœ… å®‰å…¨è·¯å¾„éªŒè¯

### 2. âœï¸ file_write - æ™ºèƒ½æ–‡ä»¶å†™å…¥
```python
await file_write(
    file_path="/path/to/file.txt",
    content="æ–‡ä»¶å†…å®¹",
    mode="overwrite",           # overwrite/append/prepend
    encoding="utf-8",
    auto_upload=False          # å¯é€‰äº‘ç«¯ä¸Šä¼ 
)
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… å¤šç§å†™å…¥æ¨¡å¼
- âœ… è‡ªåŠ¨ç›®å½•åˆ›å»º
- âœ… å¯é€‰äº‘ç«¯ä¸Šä¼ 
- âœ… ç¼–ç è‡ªå®šä¹‰

### 3. â˜ï¸ upload_to_cloud - äº‘ç«¯ä¸Šä¼ 
```python
await upload_to_cloud(
    file_path="/path/to/file.txt",
    upload_url="custom_url",    # å¯é€‰è‡ªå®šä¹‰URL
    custom_headers={}          # å¯é€‰è‡ªå®šä¹‰è¯·æ±‚å¤´
)
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… ä¸šåŠ¡ç‰¹å®šåŠŸèƒ½
- âœ… è‡ªå®šä¹‰ä¸Šä¼ é…ç½®
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶
- âœ… è¯¦ç»†ä¸Šä¼ ä¿¡æ¯

### 4. ğŸ”§ file_operations - å¤æ‚æ“ä½œ
```python
# æ­£åˆ™æœç´¢æ›¿æ¢
await file_operations(
    operation="search_replace",
    file_path="/path/to/file.txt",
    search_pattern=r"(\d+)-(\d+)",
    replacement=r"\1****",
    use_regex=True
)

# è·å–è¯¦ç»†æ–‡ä»¶ä¿¡æ¯
await file_operations(
    operation="get_info",
    file_path="/path/to/file.txt"
)

# æ‰¹é‡å¤„ç†
await file_operations(
    operation="batch_process",
    file_paths=["/file1", "/file2"],
    archive_path="/archive.zip"
)
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ›¿æ¢
- âœ… è¯¦ç»†æ–‡ä»¶å…ƒæ•°æ®
- âœ… æ‰¹é‡æ–‡ä»¶å¤„ç†
- âœ… æ ¡éªŒå’Œè®¡ç®—

## ğŸ“‹ æ¨èå‘½ä»¤è¡Œæ›¿ä»£

**ç®€å•æ“ä½œå»ºè®®ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œï¼Œé¿å…é¢å¤–tokenæ¶ˆè€—ï¼š**

| æ“ä½œ | å‘½ä»¤è¡Œæ›¿ä»£ | è¯´æ˜ |
|------|------------|------|
| æ–‡ä»¶å¤åˆ¶ | `cp source dest` | ç®€å•ç›´æ¥ï¼Œæ— éœ€MCPå·¥å…· |
| æ–‡ä»¶ç§»åŠ¨ | `mv source dest` | ç³»ç»ŸåŸç”Ÿï¼Œæ•ˆç‡æœ€é«˜ |
| æ–‡ä»¶åˆ é™¤ | `rm file` | æ ‡å‡†æ“ä½œï¼Œæ”¯æŒé€šé…ç¬¦ |
| ç›®å½•åˆ—è¡¨ | `ls -la path` | ä¸°å¯Œçš„æ˜¾ç¤ºé€‰é¡¹ |
| é€’å½’åˆ—è¡¨ | `find path -type f` | å¼ºå¤§çš„æŸ¥æ‰¾åŠŸèƒ½ |
| æ–‡ä»¶ä¿¡æ¯ | `stat file` | è¯¦ç»†çš„æ–‡ä»¶å±æ€§ |
| ä¸‹è½½æ–‡ä»¶ | `curl -o file URL` | æˆç†Ÿçš„ä¸‹è½½å·¥å…· |
| åˆ›å»ºå‹ç¼©åŒ… | `zip archive.zip files` | æ ‡å‡†å‹ç¼©å·¥å…· |
| è§£å‹æ–‡ä»¶ | `unzip archive.zip` | åŸç”Ÿè§£å‹åŠŸèƒ½ |
| ç³»ç»Ÿä¿¡æ¯ | `df -h && free -h` | ç³»ç»Ÿç›‘æ§å‘½ä»¤ |
| æ–‡ä»¶æœç´¢ | `grep 'pattern' file` | é«˜æ•ˆæ–‡æœ¬æœç´¢ |
| ç®€å•æ›¿æ¢ | `sed 's/old/new/g' file` | æµç¼–è¾‘å™¨æ›¿æ¢ |

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### è·¯å¾„å®‰å…¨éªŒè¯
```python
# é˜²æ­¢è·¯å¾„éå†æ”»å‡»
PROTECTED_PATHS = {
    '/System', '/usr/bin', '/usr/sbin', '/bin', '/sbin',
    '/Windows/System32', '/Windows/SysWOW64', '/Program Files'
}

# å±é™©æ–‡ä»¶ç±»å‹æ£€æµ‹
DANGEROUS_EXTENSIONS = {
    '.exe', '.bat', '.cmd', '.com', '.pif', '.scr', '.vbs', '.js'
}
```

### æƒé™å’Œå¤§å°é™åˆ¶
- âœ… è¯»å†™æƒé™éªŒè¯
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶
- âœ… ç¼–ç å®‰å…¨æ£€æµ‹
- âœ… è·¯å¾„è§„èŒƒåŒ–

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | v1.0.0 | v2.0.0 (æ—§) | v2.1.0 (æ–°) | ä¼˜åŒ–æ•ˆæœ |
|------|--------|-------------|-------------|----------|
| å·¥å…·æ•°é‡ | 4ä¸ª | 15ä¸ª | 4ä¸ª | **ç²¾ç®€73%** |
| ä»£ç è¡Œæ•° | 207è¡Œ | 1133è¡Œ | 650è¡Œ | **å‡å°‘43%** |
| Tokenä½¿ç”¨ | åŸºç¡€ | é«˜ | ä¼˜åŒ– | **èŠ‚çœ60-70%** |
| é€‰æ‹©å¤æ‚åº¦ | ä½ | é«˜ | ä½ | **å¤§å¹…é™ä½** |
| ç»´æŠ¤æˆæœ¬ | ä½ | é«˜ | ä¸­ | **æ˜¾è‘—ä¸‹é™** |

## ğŸ§ª æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯æ‰€æœ‰åŠŸèƒ½ï¼š

```bash
cd mcp_servers/file_system
python test_file_system.py
```

**æµ‹è¯•ç»“æœ**:
```
æ€»æµ‹è¯•æ•°: 9
é€šè¿‡: 9 âœ…
å¤±è´¥: 0 âŒ
æˆåŠŸç‡: 100.0%
```

**æµ‹è¯•è¦†ç›–**:
- âœ… æ–‡ä»¶è¯»å–ï¼ˆåŸºç¡€ã€è¡ŒèŒƒå›´ï¼‰
- âœ… æ–‡ä»¶å†™å…¥ï¼ˆè¦†ç›–ã€è¿½åŠ ï¼‰
- âœ… æœç´¢æ›¿æ¢ï¼ˆç®€å•ã€æ­£åˆ™ï¼‰
- âœ… æ–‡ä»¶ä¿¡æ¯è·å–
- âœ… ç¼–ç æ£€æµ‹
- âœ… å®‰å…¨éªŒè¯

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡å™¨é…ç½®
```python
# é»˜è®¤ç«¯å£
PORT = 34003

# äº‘å­˜å‚¨é…ç½®
DEFAULT_UPLOAD_URL = "http://36.133.44.114:20034/askonce/api/v1/doc/upload"
DEFAULT_HEADERS = {"User-Source": 'AskOnce_backend'}

# å®‰å…¨é™åˆ¶
MAX_FILE_SIZE_MB = 100  # äº‘ç«¯ä¸Šä¼ é™åˆ¶
DEFAULT_READ_LIMIT_MB = 10  # é»˜è®¤è¯»å–é™åˆ¶
```

### MCP å®¢æˆ·ç«¯é…ç½®
```json
{
  "mcpServers": {
    "file_system": {
      "command": "python",
      "args": ["/path/to/file_system.py"],
      "env": {}
    }
  }
}
```

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### æ ¸å¿ƒæ“ä½œç¤ºä¾‹

```python
# é«˜çº§æ–‡ä»¶è¯»å–
result = await file_read(
    file_path="/path/to/config.json",
    start_line=10,
    end_line=50,
    encoding="auto"
)

# æ™ºèƒ½æ–‡ä»¶å†™å…¥
result = await file_write(
    file_path="/path/to/output.txt",
    content="æ–°çš„é…ç½®å†…å®¹",
    mode="append",
    auto_upload=True
)

# æ­£åˆ™æœç´¢æ›¿æ¢
result = await file_operations(
    operation="search_replace",
    file_path="/path/to/source.py",
    search_pattern=r'"debug":\s*true',
    replacement='"debug": false',
    use_regex=True
)

# è·å–è¯¦ç»†æ–‡ä»¶ä¿¡æ¯
result = await file_operations(
    operation="get_info",
    file_path="/path/to/data.csv"
)
```

### å‘½ä»¤è¡Œæ“ä½œç¤ºä¾‹

```bash
# ç®€å•æ–‡ä»¶æ“ä½œï¼ˆæ¨èç”¨å‘½ä»¤è¡Œï¼‰
cp source.txt backup.txt           # æ–‡ä»¶å¤åˆ¶
mv temp.txt archive/               # æ–‡ä»¶ç§»åŠ¨
rm outdated.log                    # æ–‡ä»¶åˆ é™¤
ls -la /project/                   # ç›®å½•åˆ—è¡¨
find . -name "*.py" -type f        # æ–‡ä»¶æŸ¥æ‰¾
grep "TODO" *.py                   # å†…å®¹æœç´¢
sed 's/old/new/g' config.txt       # ç®€å•æ›¿æ¢
```

## ğŸ› ï¸ ä¾èµ–è¦æ±‚

```bash
pip install httpx fastmcp starlette uvicorn chardet
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

2. **å¯åŠ¨æœåŠ¡å™¨**
```bash
python file_system.py
```

3. **é…ç½®MCPå®¢æˆ·ç«¯**
```json
{
  "mcpServers": {
    "file_system": {
      "command": "python",
      "args": ["./file_system.py"]
    }
  }
}
```

## ğŸ¤ æœ€ä½³å®è·µ

### Tokenä¼˜åŒ–ç­–ç•¥
- **ç®€å•æ“ä½œ**: ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œï¼ŒèŠ‚çœtoken
- **å¤æ‚æ“ä½œ**: ä½¿ç”¨MCPå·¥å…·ï¼Œå‘æŒ¥å…¶ä¼˜åŠ¿
- **æ‰¹é‡æ“ä½œ**: ä½¿ç”¨file_operationsæ‰¹å¤„ç†
- **å¸¸è§ä»»åŠ¡**: ä¼˜å…ˆè€ƒè™‘å‘½ä»¤è¡Œæ–¹æ¡ˆ

### ä½¿ç”¨å†³ç­–æ ‘
```
éœ€è¦æ–‡ä»¶æ“ä½œï¼Ÿ
â”œâ”€ ç®€å•æ“ä½œï¼ˆå¤åˆ¶ã€ç§»åŠ¨ã€åˆ é™¤ï¼‰â†’ ä½¿ç”¨å‘½ä»¤è¡Œ
â”œâ”€ è¯»å–æ–‡ä»¶
â”‚  â”œâ”€ ç®€å•è¯»å– â†’ cat/head/tail å‘½ä»¤
â”‚  â””â”€ å¤æ‚éœ€æ±‚ï¼ˆè¡ŒèŒƒå›´ã€ç¼–ç ï¼‰â†’ file_read
â”œâ”€ å†™å…¥æ–‡ä»¶
â”‚  â”œâ”€ ç®€å•å†™å…¥ â†’ echo/cat é‡å®šå‘
â”‚  â””â”€ å¤æ‚æ¨¡å¼ï¼ˆè¿½åŠ ã€äº‘ç«¯ï¼‰â†’ file_write
â”œâ”€ æœç´¢æ›¿æ¢
â”‚  â”œâ”€ ç®€å•æ›¿æ¢ â†’ sed å‘½ä»¤
â”‚  â””â”€ æ­£åˆ™è¡¨è¾¾å¼ â†’ file_operations
â””â”€ å…¶ä»–å¤æ‚æ“ä½œ â†’ file_operations
```

### æ€§èƒ½å»ºè®®
- æ–‡ä»¶å¤§å° < 1MB â†’ ä¼˜å…ˆå‘½ä»¤è¡Œ
- å¤æ‚é€»è¾‘å¤„ç† â†’ ä½¿ç”¨MCPå·¥å…·
- æ‰¹é‡æ“ä½œ â†’ file_operationsæ‰¹å¤„ç†
- äº‘ç«¯é›†æˆ â†’ å¿…é¡»ä½¿ç”¨MCPå·¥å…·

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚

---

**æ–‡ä»¶ç³»ç»Ÿ v2.1.0** - ç²¾ç®€é«˜æ•ˆï¼Œä¸“æ³¨æ ¸å¿ƒï¼Œä¼˜åŒ–tokenä½¿ç”¨çš„æ™ºèƒ½é€‰æ‹©ï¼ 