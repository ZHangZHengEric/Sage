server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;


  # Basic security headers
  add_header X-Content-Type-Options nosniff;
  add_header X-Frame-Options SAMEORIGIN;
  add_header X-XSS-Protection "1; mode=block";
      gzip on;
    gzip_min_length 1k;
    gzip_comp_level 6;
    gzip_types text/plain
        application/javascript
        application/x-javascript
        text/css
        application/xml
        text/javascript
        application/x-httpd-php
        image/jpeg
        image/gif
        image/png;
    gzip_vary on;
    gzip_disable "MSIE [1-6]\.";
    client_max_body_size 512m;
    client_body_buffer_size 20m;    # 内存缓存区
    proxy_connect_timeout 30000s;     # 连接超时
    proxy_send_timeout    30000s;     # 发送超时
    proxy_read_timeout    30000s;     # 响应超时
    send_timeout          30000s;     # 客户端接收超时
    proxy_buffer_size 512k;
    proxy_buffers 4  1024k;
    proxy_busy_buffers_size 1024k;
    proxy_cache off; # 关闭缓存
    proxy_buffering off; # 关闭代理缓冲
    chunked_transfer_encoding on; # 开启分块传输编码
    tcp_nopush on; # 开启TCP NOPUSH选项，禁止Nagle算法
    tcp_nodelay on; # 开启TCP NODELAY选项，禁止延迟ACK算法
    keepalive_timeout 30000; # 设定keep-alive超时时间为65秒
  # Serve static files with caching
    location /assets/ {
      try_files $uri =404;
      expires 7d;
      add_header Cache-Control "public, max-age=604800";
    }

    # SPA fallback
    location / {
      try_files $uri $uri/ /index.html;
    }

    location /prod-api/api/ {
        rewrite "^/prod-api/(.*)$" /$1 break;
        proxy_pass http://172.17.0.1:30050;  # 目标服务器地址
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }
}